<div class="dashboard-container">
  <header class="dashboard-header">
    <h1>Minha Conta</h1>
  <button type="button" class="btn-logout" (click)="sair()">Sair</button>
  </header>

  <div class="dashboard-content">
    <div class="dashboard-grid">
      <!-- Informa√ß√µes do Usu√°rio -->
  <div class="dashboard-card" *ngIf="usuario() as u">
        <h2>Perfil</h2>
        <div class="user-info">
          <div class="user-avatar">
            <span>{{ iniciais() }}</span>
          </div>
          <div class="user-details">
            <h3>{{ u.firstName }} {{ u.lastName }}</h3>
            <p>{{ u.email }}</p>
            <p *ngIf="u.phone">{{ u.phone }}</p>
            <p class="verify-status" [class.verified]="u.isEmailVerified">
              {{ u.isEmailVerified ? 'Email verificado' : 'Email n√£o verificado' }}
            </p>
          </div>
        </div>
  <button type="button" class="btn-secondary" (click)="editarPerfil()">Editar Perfil</button>
      </div>

      <!-- Cart√µes Salvos -->
      <div class="dashboard-card">
        <h2>Cart√µes Salvos</h2>
  <div *ngIf="carregandoCartoes(); else cardsBlock">Carregando...</div>
        <ng-template #cardsBlock>
          <div class="saved-cards empty" *ngIf="cartoes().length === 0 && !mostrarFormularioNovoCartao()">
            <p class="empty-text">Nenhum cart√£o salvo ainda.</p>
          </div>
          <div class="saved-cards" *ngIf="cartoes().length > 0">
            <div class="card-item" *ngFor="let c of cartoes()">
              <div class="card-info">
                <span class="card-brand">{{ c.cardBrand | uppercase }} <span *ngIf="c.isDefault" class="default-badge">Padr√£o</span></span>
                <span class="card-number">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ {{ c.lastFourDigits }}</span>
                <span class="card-exp">Exp: {{ c.expirationMonth }}/{{ c.expirationYear }}</span>
              </div>
              <div class="card-actions">
                <button type="button" class="btn-mini" (click)="definirPadrao(c)" [disabled]="definindoPadraoId()===c.id || c.isDefault">
                  {{ definindoPadraoId()===c.id ? '...' : c.isDefault ? 'Padr√£o' : 'Definir' }}
                </button>
                <button type="button" class="btn-remove" (click)="removerCartao(c)" [disabled]="removendoCartaoId()===c.id">
                  {{ removendoCartaoId()===c.id ? '...' : 'Remover' }}
                </button>
              </div>
            </div>
          </div>
        </ng-template>
        <div *ngIf="mostrarFormularioNovoCartao()" class="add-card-form">
          <h3>Novo Cart√£o</h3>
          <div class="form-grid">
            <div class="field">
              <label>N√∫mero</label>
              <input type="text" [(ngModel)]="novoCartao().cardNumber" name="cardNumber" (input)="formatarNumeroCartaoInput()" placeholder="#### #### #### ####" />
            </div>
            <div class="field">
              <label>Nome Impresso</label>
              <input type="text" [(ngModel)]="novoCartao().cardHolderName" name="cardHolderName" placeholder="EX: JOAO SILVA" />
            </div>
            <div class="field small">
              <label>M√™s</label>
              <input type="text" maxlength="2" [(ngModel)]="novoCartao().expirationMonth" name="expirationMonth" placeholder="MM" />
            </div>
            <div class="field small">
              <label>Ano</label>
              <input type="text" maxlength="4" [(ngModel)]="novoCartao().expirationYear" name="expirationYear" placeholder="YYYY" />
            </div>
            <div class="field small">
              <label>CVV</label>
              <input type="password" maxlength="4" [(ngModel)]="novoCartao().cvv" name="cvv" placeholder="***" />
            </div>
            <div class="field inline">
              <label>
                <input type="checkbox" [(ngModel)]="novoCartao().isDefault" name="isDefault" /> Padr√£o
              </label>
            </div>
          </div>
          <div class="card-errors" *ngIf="errosCartao().length > 0">
            <div class="error-line" *ngFor="let e of errosCartao()">{{ e }}</div>
          </div>
          <div class="actions">
            <button type="button" class="btn-secondary" (click)="mostrarFormularioNovoCartao.set(false)" [disabled]="salvandoCartao()">Cancelar</button>
            <button type="button" class="btn-primary" (click)="enviarNovoCartao()" [disabled]="salvandoCartao()">{{ salvandoCartao() ? 'Salvando...' : 'Salvar Cart√£o' }}</button>
          </div>
        </div>
        <button *ngIf="!mostrarFormularioNovoCartao()" type="button" class="btn-secondary" (click)="abrirFormularioNovoCartao()">Adicionar Cart√£o</button>
      </div>

      <!-- Transa√ß√µes Recentes -->
      <div class="dashboard-card full-width">
        <h2>Transa√ß√µes Recentes</h2>
        <div *ngIf="carregandoTransacoes(); else listaTransacoes">Carregando...</div>
        <ng-template #listaTransacoes>
          <div class="transactions-list" *ngIf="transacoesRecentes().length > 0; else vazioTransacoes">
            <div class="transaction-item" *ngFor="let t of transacoesRecentes()">
              <div class="transaction-info">
                <span class="transaction-description">{{ descricaoTransacao(t) }}</span>
                <span class="transaction-date">{{ t.createdAt | date:'dd/MM/yyyy HH:mm' }}</span>
              </div>
              <span class="transaction-amount">{{ paymentService.formatCurrency(t.amount, t.currency) }}</span>
              <span class="transaction-status" [class]="'transaction-status ' + statusClass(t.status)">{{ formatStatus(t.status) }}</span>
            </div>
          </div>
          <ng-template #vazioTransacoes>
            <p class="empty-text">Nenhuma transa√ß√£o recente.</p>
          </ng-template>
        </ng-template>
        <button type="button" class="btn-secondary" (click)="router.navigate(['/transacoes'])">Ver Todas</button>
      </div>

      <!-- A√ß√µes R√°pidas -->
      <div class="dashboard-card">
        <h2>A√ß√µes R√°pidas</h2>
        <div class="quick-actions">
          <button type="button" class="quick-action-btn" (click)="novoPagamento()">
            <span class="action-icon">üí≥</span>
            <span>Novo Pagamento</span>
          </button>
          <button type="button" class="quick-action-btn" (click)="irParaRelatorios()">
            <span class="action-icon">üìä</span>
            <span>Relat√≥rios</span>
          </button>
          <button type="button" class="quick-action-btn" (click)="irParaConfiguracoes()">
            <span class="action-icon">‚öôÔ∏è</span>
            <span>Configura√ß√µes</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
